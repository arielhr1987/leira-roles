window.wp=window.wp||{};inlineEditL10n={error:"Error while saving the changes.",saved:"Changes saved."};(function($,wp){window.inlineEditUserCapabilities={init:function(){var t=this,row=$("#inline-edit-capabilities");t.type=$("#the-list").attr("data-wp-lists").substr(5);t.what="#"+t.type+"-";$("#the-list").on("click",".editinline_capabilities",function(){$(this).attr("aria-expanded","true");inlineEditUserCapabilities.edit(this)});row.keyup(function(e){if(e.which===27){return inlineEditUserCapabilities.revert()}});$(".cancel",row).click(function(){return inlineEditUserCapabilities.revert()});$(".save",row).click(function(){return inlineEditUserCapabilities.save(this)});$("input, select",row).keydown(function(e){if(e.which===13&&$(this).prop("name")!=="capabilities_search_input"){return inlineEditUserCapabilities.save(this)}});$('#posts-filter input[type="submit"]').mousedown(function(){t.revert()});$(":checkbox.cb-capabilities-select-all",row).on("change",function(){var cb=$(this);var cbs=cb.parents(".input-text-wrap").find(".capabilities-container :checkbox").not(cb);cbs.prop("checked",cb.is(":checked"))});$('input[name="capabilities_search_input"]',row).on("keyup input",function(e){var input=$(this);var search=input.val();var container=input.parents(".input-text-wrap").find(".capabilities-container");$(".notice",container).addClass("hidden");container.find("> label.capability-item").each(function(index,item){var toggle=true;if(search.trim()===""){toggle=true}else{toggle=$(item).text().indexOf(search)!==-1}$(this).toggleClass("hidden",!toggle)});if(!$("> label.capability-item:not(.hidden)",container).length){$(".notice",container).removeClass("hidden")}}).on("keydown",function(e){if(e.which===13){return false}})},toggle:function(el){var t=this;$(t.what+t.getId(el)).css("display")==="none"?t.revert():t.edit(el)},edit:function(id){var editRow,rowData,val,t=this;t.revert();if(typeof id==="object"){id=t.getId(id)}editRow=$("#inline-edit-capabilities").clone(true),rowData=$("#inline_capabilities_"+id);$("td",editRow).attr("colspan",$("th:visible, td:visible",".wp-list-table.widefat:first thead").length);$(t.what+id).hide().after(editRow).after('<tr class="hidden"></tr>');$("> div",rowData).each(function(index,value){value=$(value);var name=value.attr("class");value=value.text();if(name==="capabilities"){var container=$("div.capabilities-container",editRow);var json=JSON.parse(value);$.each(json,function(capability,value){var html='<label class="alignleft capability-item" title="'+capability+'">'+'<input type="checkbox" name="capability[]" value="'+capability+'"'+(value?' checked="checked"':"")+">"+'<span class="checkbox-title">'+capability+"</span>"+"</label>";container.append(html)})}else{$(":input[name="+name+"]",editRow).val(value)}});$(editRow).attr("id","edit-"+id).addClass("inline-editor").show();$(".ptitle",editRow).eq(0).focus();return false},save:function(id){var params,fields;if(typeof id==="object"){id=this.getId(id)}$("table.widefat .spinner").addClass("is-active");params={action:"leira-roles-quick-edit-user-capabilities"};fields=$("#edit-"+id).find(":input").serialize();params=fields+"&"+$.param(params);$.post(ajaxurl,params,function(r){var row,new_id,option_value,$errorNotice=$("#edit-"+id+" .inline-edit-save .notice-error"),$error=$errorNotice.find(".error");$("table.widefat .spinner").removeClass("is-active");if(r){if(-1!==r.indexOf("<tr")){$(inlineEditUserCapabilities.what+id).siblings("tr.hidden").addBack().remove();new_id=$(r).attr("id");$("#edit-"+id).before(r).remove();if(new_id){option_value=new_id.replace(inlineEditUserCapabilities.type+"-","");row=$("#"+new_id)}else{option_value=id;row=$(inlineEditUserCapabilities.what+id)}row.hide().fadeIn(400,function(){row.find(".editinline_capabilities").attr("aria-expanded","false").focus();wp.a11y.speak(inlineEditL10n.saved)})}else{$errorNotice.removeClass("hidden");$error.html(r);wp.a11y.speak($error.text())}}else{$errorNotice.removeClass("hidden");$error.html(inlineEditL10n.error);wp.a11y.speak(inlineEditL10n.error)}});return false},revert:function(){var id=$("table.widefat tr.inline-editor").attr("id");if(id){$("table.widefat .spinner").removeClass("is-active");$("#"+id).siblings("tr.hidden").addBack().remove();id=id.substr(id.lastIndexOf("-")+1);$(this.what+id).show().find(".editinline_capabilities").attr("aria-expanded","false").focus()}},getId:function(o){var id=o.tagName==="TR"?o.id:$(o).parents("tr").attr("id"),parts=id.split("-");return parts[parts.length-1]}};$(document).ready(function(){inlineEditUserCapabilities.init()})})(jQuery,window.wp);